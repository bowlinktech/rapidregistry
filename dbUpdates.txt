
/** 4-20-15 @ 10:22 AM Chad **/

INSERT INTO `rapidregistry`.`lu_programModules` (`moduleName`, `displayName`) VALUES ('calendar', 'Calendar');
INSERT INTO `rapidregistry`.`lu_programModules` (`moduleName`, `displayName`) VALUES ('faq', 'FAQ');
INSERT INTO `rapidregistry`.`lu_programModules` (`moduleName`, `displayName`) VALUES ('forum', 'Forum');


CREATE TABLE `rapidregistry`.`calendarEventTypes` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `eventType` VARCHAR(55) NOT NULL,
  `eventTypeColor` VARCHAR(8) NOT NULL,
  `adminOnly` BIT(1) NOT NULL DEFAULT b'0',
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC));

CREATE TABLE `rapidregistry`.`calendarNotificationPreferences` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `systemUserId` INT NOT NULL,
  `notificationEmail` VARCHAR(255) NOT NULL,
  `emailAlertMin` INT NOT NULL DEFAULT 0 COMMENT '0 = NO ALERTS\n1 = At time of event\n5 = 5 Min before\n10 = 10 Min before\n15 = 15 Min before\n30 = 30 min before\n60 = 1 hour before\n120 = 2 hour before\n1440 = 1 day before\n2880 = 2 days before\n',
  `newEventNotifications` BIT(1) NOT NULL DEFAULT b'1',
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC));

CREATE TABLE `rapidregistry`.`calendarEvents` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `systemUserId` INT NOT NULL COMMENT 'The userID who created the event.',
  `eventDate` DATETIME NOT NULL,
  `eventStartTime` VARCHAR(10) NULL,
  `eventEndTime` VARCHAR(10) NULL,
  `eventTitle` VARCHAR(55) NOT NULL,
  `eventLocation` VARCHAR(255) NULL,
  `eventNotes` VARCHAR(255) NULL,
  `eventTypeId` INT NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC));

CREATE TABLE `rapidregistry`.`calendarEventDocuments` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `calendarEventId` INT NOT NULL,
  `documentLocation` VARCHAR(255) NOT NULL,
  `documentTitle` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC));

CREATE TABLE `rapidregistry`.`calendarEventUserNotifications` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `calendarEventId` INT NOT NULL,
  `systemUserId` INT NOT NULL,
  `emailAlertMin` INT NOT NULL DEFAULT '0' COMMENT '0 = NO ALERTS\n1 = At time of event\n5 = 5 Min before\n10 = 10 Min before\n15 = 15 Min before\n30 = 30 min before\n60 = 1 hour before\n120 = 2 hour before\n1440 = 1 day before\n2880 = 2 days before',
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC));

ALTER TABLE `rapidregistry`.`calendarEvents` 
ADD COLUMN `programId` INT(11) NOT NULL AFTER `id`;

ALTER TABLE `rapidregistry`.`calendarEventTypes` 
ADD COLUMN `programId` VARCHAR(45) NOT NULL AFTER `id`;

CREATE TABLE `rapidregistry`.`forumMessages` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `programId` int(11) NOT NULL,
  `parentMessageId` int(11) NOT NULL DEFAULT '0' COMMENT '0 = Original Message',
  `topicType` int(11) NOT NULL DEFAULT '2' COMMENT '1 = Announcement\n2 = Regular Topic',
  `topicTitle` varchar(255) NOT NULL,
  `topicMessage` varchar(45) NOT NULL,
  `systemUserId` int(11) NOT NULL COMMENT 'The userId of the person who created the topic',
  `totalViews` int(11) NOT NULL DEFAULT '0',
  `totalReplies` int(11) NOT NULL DEFAULT '0',
  `dateCreated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_UNIQUE` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `rapidregistry`.`forumDocuments` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `forumMessageId` varchar(45) NOT NULL,
  `documentLocation` varchar(255) NOT NULL,
  `documentTitle` varchar(255) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id_UNIQUE` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `rapidregistry`.`faqQuestions` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `programId` INT(11) NOT NULL,
  `question` VARCHAR(255) NOT NULL,
  `answer` LONGTEXT NOT NULL,
  `displayPos` INT(11) NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC));

CREATE TABLE `rapidregistry`.`faqQuestionDocuments` (
  `id` INT(11) NOT NULL AUTO_INCREMENT,
  `faqId` INT(11) NOT NULL,
  `documentLocation` VARCHAR(255) NOT NULL,
  `documentTitle` VARCHAR(255) NOT NULL,
  PRIMARY KEY (`id`),
  UNIQUE INDEX `id_UNIQUE` (`id` ASC));
  
  
  /** grace 04.17.2015 05:58PM **/
ALTER TABLE `rapidregistry`.`put_formFields` 
ADD COLUMN `useField` BIT(1) NOT NULL DEFAULT 1 AFTER `dspPos`;

ALTER TABLE `rapidregistry`.`put_formFields` 
ADD COLUMN `multiValue` BIT(1) NULL DEFAULT 0 AFTER `useField`;

/** grace 04.21.2015 03:33PM **/
ALTER TABLE `rapidregistry`.`storage_engagements` 
ADD COLUMN `visitDate` DATETIME NULL AFTER `programorghierarchy_detailsId`,
ADD COLUMN `contraceptiveInitialId` INT NULL AFTER `contraceptiveMethodAfterId`,
ADD COLUMN `noContraceptiveReasonId` INT NULL AFTER `contraceptiveInitialId`;

ALTER TABLE `rapidregistry`.`storage_engagements` 
CHANGE COLUMN `referralDate` `referralDate` DATETIME NULL ;

ALTER TABLE `rapidregistry`.`storage_engagements` 
ADD COLUMN `BMI` DECIMAL(2) NULL AFTER `noContraceptiveReasonId`;

ALTER TABLE `rapidregistry`.`storage_engagements` 
CHANGE COLUMN `BMI` `BMI` FLOAT NULL DEFAULT NULL ,
ADD COLUMN `height` FLOAT NULL AFTER `BMI`,
ADD COLUMN `weight` FLOAT NULL AFTER `height`,
ADD COLUMN `bpDia` FLOAT NULL AFTER `weight`,
ADD COLUMN `bpSys` FLOAT NULL AFTER `bp_diastolic`;

delete from  `rapidregistry`.`storage_engagements`;

ALTER TABLE `rapidregistry`.`storage_engagements` 
CHANGE COLUMN `engagementId` `storage_patientsId` INT(11) NOT NULL ;

ALTER TABLE `rapidregistry`.`storage_engagements` 
DROP INDEX `engagementId_idx` ;

ALTER TABLE `rapidregistry`.`storage_engagements` 
ADD CONSTRAINT `fk_storage_patient`
  FOREIGN KEY (`storage_patientsId`)
  REFERENCES `rapidregistry`.`storage_patients` (`id`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;
  

/** Chad 4-23-2015 @ 10:15 AM **/

ALTER TABLE `rapidregistry`.`lu_programModules` 
ADD COLUMN `linkIcon` VARCHAR(45) NULL AFTER `displayName`;

UPDATE `rapidregistry`.`lu_programModules` SET `linkIcon`='fa-calendar' WHERE `id`='7';
UPDATE `rapidregistry`.`lu_programModules` SET `linkIcon`='fa-question' WHERE `id`='8';
INSERT INTO `rapidregistry`.`lu_programModules` (`moduleName`, `displayName`, `linkIcon`) VALUES ('document', 'Documents', 'fa-upload');
UPDATE `rapidregistry`.`lu_programModules` SET `linkIcon`='fa-archive' WHERE `id`='9';
UPDATE `rapidregistry`.`lu_programModules` SET `linkIcon`='fa-clock-o' WHERE `id`='6';
UPDATE `rapidregistry`.`lu_programModules` SET `linkIcon`='fa-download' WHERE `id`='4';
UPDATE `rapidregistry`.`lu_programModules` SET `linkIcon`='fa-user' WHERE `id`='1';
UPDATE `rapidregistry`.`lu_programModules` SET `linkIcon`='fa-bars' WHERE `id`='3';


/** grace 04-27-2015 1:25PM **/
ALTER TABLE `rapidregistry`.`storage_engagementMedicalServices` 
CHANGE COLUMN `engagementId` `storage_engagementId` INT(11) NOT NULL ;

delete from `rapidregistry`.`storage_engagementMedicalServices`;

ALTER TABLE `rapidregistry`.`storage_engagements` 
ADD COLUMN `engagementId` INT NULL AFTER `storage_patientsId`;

ALTER TABLE `rapidregistry`.`storage_engagementsMisc` 
CHANGE COLUMN `engagementId` `storage_engagementId` INT(11) NOT NULL ;

ALTER TABLE `rapidregistry`.`storage_engagementMedicalServices` 
ADD INDEX `mainStorageKey_idx` (`storage_engagementId` ASC);
ALTER TABLE `rapidregistry`.`storage_engagementMedicalServices` 
ADD CONSTRAINT `mainStorageKey`
  FOREIGN KEY (`storage_engagementId`)
  REFERENCES `rapidregistry`.`storage_engagements` (`id`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;


ALTER TABLE `rapidregistry`.`storage_engagementsMisc` 
ADD INDEX `FKStorageKey_idx` (`storage_engagementId` ASC);
ALTER TABLE `rapidregistry`.`storage_engagementsMisc` 
ADD CONSTRAINT `FKStorageKey`
  FOREIGN KEY (`storage_engagementId`)
  REFERENCES `rapidregistry`.`storage_engagements` (`id`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;


/** FP patients have multiple check boxes, need to be able to display back each one they checked on forms **/
CREATE TABLE `rapidregistry`.`storage_races` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `storage_engagementId` INT NOT NULL,
  `raceId` INT NOT NULL,
  PRIMARY KEY (`id`));


ALTER TABLE `rapidregistry`.`storage_races` 
ADD INDEX `FKStorageEngagementId_idx` (`storage_engagementId` ASC);
ALTER TABLE `rapidregistry`.`storage_races` 
ADD CONSTRAINT `FKStorageEngagementId`
  FOREIGN KEY (`storage_engagementId`)
  REFERENCES `rapidregistry`.`storage_engagements` (`id`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;
  
  CREATE TABLE `rapidregistry`.`storage_localCodes` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `storage_engagementId` INT NOT NULL,
  `localCode` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id`));
  
  
  ALTER TABLE `rapidregistry`.`storage_localCodes` 
ADD INDEX `storage_engagementId_idx` (`storage_engagementId` ASC);
ALTER TABLE `rapidregistry`.`storage_localCodes` 
ADD CONSTRAINT `storage_engagementId`
  FOREIGN KEY (`storage_engagementId`)
  REFERENCES `rapidregistry`.`storage_engagements` (`id`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;
  


/** 4-30-15 @ 03:29 PM Jim **/

ALTER TABLE `rapidregistry`.`calendarEventTypes` 
CHANGE COLUMN `programId` `programId` INT(11) NOT NULL ;

/** 5-01-15 @ 10:43 AM Jim **/

ALTER TABLE `rapidregistry`.`calendarEvents` 
CHANGE COLUMN `eventDate` `eventStartDate` DATETIME NOT NULL ,
ADD COLUMN `eventEndDate` DATETIME NOT NULL AFTER `eventStartDate`;


/** 05.01.15 11:13AM Grace **/
INSERT INTO `rapidregistry`.`lu_processstatus` (`id`, `category`, `displayCode`, `displayText`, `description`, `status`, `isCustom`, `endUserDisplayCode`, `endUserDisplayText`, `endUserDescription`) VALUES ('43', 'batch', 'RBL', 'RR Submission Being Loaded', 'RR file being loaded for processing', 1, 0, 'RBL', 'RR Submission Being Loaded', 'RR file being loaded for processing');

ALTER TABLE `rapidregistry`.`programUploadRecords` 
ADD COLUMN `statusId` INT NULL AFTER `programUploadId`;

CREATE TABLE `rapidregistry`.`programUploadRecords_storageInfo` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `storage_engagementsId` INT NOT NULL,
  `programUploadRecordsId` INT NOT NULL,
  PRIMARY KEY (`id`));
  
ALTER TABLE `rapidregistry`.`storage_engagements` 
ADD COLUMN `programId` INT NULL AFTER `engagementId`;
