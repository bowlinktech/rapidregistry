/** grace 02272015 11:15AM **/

drop trigger if exists rapidregistry.survey_pages_track_d;
drop trigger if exists rapidregistry.survey_pages_track_u;
DROP TRIGGER IF EXISTS `rapidregistry`.`survey_questions_track_u`;
DROP TRIGGER IF EXISTS `rapidregistry`.`survey_questions_track_d`;

USE `rapidregistry`;

DELIMITER $$

USE `rapidregistry`$$
DROP TRIGGER IF EXISTS `rapidregistry`.`survey_track_u` $$
DELIMITER ;
USE `rapidregistry`;

DELIMITER $$

USE `rapidregistry`$$
DROP TRIGGER IF EXISTS `rapidregistry`.`survey_track_d` $$
DELIMITER ;



/** grace 03022015 08:30PM **/
ALTER TABLE `rapidregistry`.`programuploadtypes` 
ADD COLUMN `fileTypeId` INT NULL AFTER `HELPickUpPath`;

CREATE TABLE `rapidregistry`.`lu_filetypes` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `fileType` varchar(45) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=latin1;

INSERT INTO rapidregistry.`lu_filetypes` VALUES (1,'Does not apply'),(2,'txt'),(3,'csv'),(4,'hl7'),(5,'mdb'),(6,'pdf'),(7,'odbc'),(8,'xls'),(9,'xml (CCD)'),(10,'doc');

UPDATE `rapidregistry`.`programuploadtypes` SET `fileTypeId`='1' WHERE `id`='5';
UPDATE `rapidregistry`.`programuploadtypes` SET `fileTypeId`='1' WHERE `id`='7';

ALTER TABLE `rapidregistry`.`programuploadtypes` 
ADD INDEX `fk_fileTypeId_idx` (`fileTypeId` ASC);
ALTER TABLE `rapidregistry`.`programuploadtypes` 
ADD CONSTRAINT `fk_fileTypeId`
  FOREIGN KEY (`fileTypeId`)
  REFERENCES `rapidregistry`.`lu_filetypes` (`id`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

ALTER TABLE `rapidregistry`.`programuploadtypes` 
ADD COLUMN `fileDelimId` INT NULL AFTER `fileTypeId`,
ADD COLUMN `maxFileSize` INT NULL AFTER `fileDelimId`;

ALTER TABLE `rapidregistry`.`programuploadtypes` 
ADD INDEX `fk_fileDelimId_idx` (`fileDelimId` ASC);
ALTER TABLE `rapidregistry`.`programuploadtypes` 
ADD CONSTRAINT `fk_fileDelimId`
  FOREIGN KEY (`fileDelimId`)
  REFERENCES `rapidregistry`.`lu_delimiters` (`id`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;
  
UPDATE `rapidregistry`.`programuploadtypes` SET `fileDelimId`='1', `maxFileSize`='5' WHERE `id`='5';
UPDATE `rapidregistry`.`programuploadtypes` SET `fileDelimId`='1', `maxFileSize`='5' WHERE `id`='7';
  
ALTER TABLE `rapidregistry`.`programuploads` 
ADD COLUMN `statusDateTime` DATETIME NULL AFTER `statusId`;



/** Chad 03032015 9:41 AM **/
ALTER TABLE `rapidregistry`.`survey_questions` 
ADD COLUMN `deleted` BIT(1) NULL DEFAULT b'0' AFTER `populateFromTable`;

ALTER TABLE `rapidregistry`.`survey_pages` 
DROP INDEX `uni_surveyIdPageNum` ,
ADD INDEX `uni_surveyIdPageNum` (`surveyId` ASC);


/** Chad 03112015 9:41 AM **/
ALTER TABLE `rapidregistry`.`survey_questionChoices` 
ADD COLUMN `skipToEnd` BIT(1) NOT NULL DEFAULT b'0' AFTER `choiceValue`;

/** Chad 03122015 9:32 AM **/
CREATE TABLE `rapidregistry`.`patient_completedSurveys` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `programpatientId` INT NOT NULL COMMENT '	',
  `surveyId` INT NOT NULL,
  `engagementId` INT NOT NULL DEFAULT '0',
  `dateCreated` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `systemUserId` INT NOT NULL,
  PRIMARY KEY (`id`));

ALTER TABLE `rapidregistry`.`survey_patientAnswers` 
ADD COLUMN `completedSurveyId` INT NOT NULL AFTER `id`, RENAME TO  `rapidregistry`.`patient_completedSurveyAnswers` ;

DROP TABLE `rapidregistry`.`engagementSurveys`;

ALTER TABLE `rapidregistry`.`patient_completedSurveys` 
ADD COLUMN `programId` INT NOT NULL AFTER `id`;

ALTER TABLE `rapidregistry`.`patient_completedSurveyAnswers` 
ADD COLUMN `surveyPageId` INT(11) NOT NULL AFTER `programPatientId`;

/** Grace 03.13.2015 12:06PM **/
CREATE TABLE `rapidregistry`.`lu_processstatus` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `category` varchar(45) NOT NULL,
  `displayCode` varchar(5) DEFAULT NULL,
  `displayText` varchar(45) DEFAULT NULL,
  `description` text,
  `status` bit(1) NOT NULL DEFAULT b'1',
  `isCustom` bit(1) NOT NULL DEFAULT b'0',
  `dateCreated` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `endUserDisplayCode` varchar(5) DEFAULT NULL,
  `endUserDisplayText` varchar(45) DEFAULT NULL,
  `endUserDescription` text,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=40 DEFAULT CHARSET=latin1;


INSERT INTO `rapidregistry`.`lu_processstatus` (`id` ,`category`, `displayCode`, `displayText`, `description`, `status`, `isCustom`, `endUserDisplayCode`, `endUserDisplayText`, `endUserDescription`) VALUES (1, 'Batch', 'LOH', 'Loaded on Health-e-Link', 'File is loaded into Health-e-Link for processing', 1, 0, 'LOH', 'Loaded on Health-e-Link', 'File is loaded into Health-e-Link for processing');


