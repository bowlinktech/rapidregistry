/** grace 02272015 11:15AM **/

drop trigger if exists rapidregistry.survey_pages_track_d;
drop trigger if exists rapidregistry.survey_pages_track_u;
DROP TRIGGER IF EXISTS `rapidregistry`.`survey_questions_track_u`;
DROP TRIGGER IF EXISTS `rapidregistry`.`survey_questions_track_d`;

USE `rapidregistry`;

DELIMITER $$

USE `rapidregistry`$$
DROP TRIGGER IF EXISTS `rapidregistry`.`survey_track_u` $$
DELIMITER ;
USE `rapidregistry`;

DELIMITER $$

USE `rapidregistry`$$
DROP TRIGGER IF EXISTS `rapidregistry`.`survey_track_d` $$
DELIMITER ;



/** grace 03022015 08:30PM **/
ALTER TABLE `rapidregistry`.`programuploadtypes` 
ADD COLUMN `fileTypeId` INT NULL AFTER `HELPickUpPath`;

CREATE TABLE `rapidregistry`.`lu_filetypes` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `fileType` varchar(45) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=latin1;

INSERT INTO rapidregistry.`lu_filetypes` VALUES (1,'Does not apply'),(2,'txt'),(3,'csv'),(4,'hl7'),(5,'mdb'),(6,'pdf'),(7,'odbc'),(8,'xls'),(9,'xml (CCD)'),(10,'doc');

UPDATE `rapidregistry`.`programuploadtypes` SET `fileTypeId`='1' WHERE `id`='5';
UPDATE `rapidregistry`.`programuploadtypes` SET `fileTypeId`='1' WHERE `id`='7';

ALTER TABLE `rapidregistry`.`programuploadtypes` 
ADD INDEX `fk_fileTypeId_idx` (`fileTypeId` ASC);
ALTER TABLE `rapidregistry`.`programuploadtypes` 
ADD CONSTRAINT `fk_fileTypeId`
  FOREIGN KEY (`fileTypeId`)
  REFERENCES `rapidregistry`.`lu_filetypes` (`id`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;

ALTER TABLE `rapidregistry`.`programuploadtypes` 
ADD COLUMN `fileDelimId` INT NULL AFTER `fileTypeId`,
ADD COLUMN `maxFileSize` INT NULL AFTER `fileDelimId`;

ALTER TABLE `rapidregistry`.`programuploadtypes` 
ADD INDEX `fk_fileDelimId_idx` (`fileDelimId` ASC);
ALTER TABLE `rapidregistry`.`programuploadtypes` 
ADD CONSTRAINT `fk_fileDelimId`
  FOREIGN KEY (`fileDelimId`)
  REFERENCES `rapidregistry`.`lu_delimiters` (`id`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;
  
UPDATE `rapidregistry`.`programuploadtypes` SET `fileDelimId`='1', `maxFileSize`='5' WHERE `id`='5';
UPDATE `rapidregistry`.`programuploadtypes` SET `fileDelimId`='1', `maxFileSize`='5' WHERE `id`='7';
  
ALTER TABLE `rapidregistry`.`programuploads` 
ADD COLUMN `statusDateTime` DATETIME NULL AFTER `statusId`;



/** Chad 03032015 9:41 AM **/
ALTER TABLE `rapidregistry`.`survey_questions` 
ADD COLUMN `deleted` BIT(1) NULL DEFAULT b'0' AFTER `populateFromTable`;

ALTER TABLE `rapidregistry`.`survey_pages` 
DROP INDEX `uni_surveyIdPageNum` ,
ADD INDEX `uni_surveyIdPageNum` (`surveyId` ASC);

